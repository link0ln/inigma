name = "inigma"
main = "index.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Observability configuration (logs)
[observability]
enabled = true

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true

# Development environment
[env.development]
routes = [ { pattern = "inigma-dev.idone.su", custom_domain = true } ]

# D1 database binding (same as production)
[[env.development.d1_databases]]
binding = "INIGMA_DB"
database_name = "inigma-database"
database_id = "f9c64d33-553f-4e98-a655-1e95750550af"

# KV namespace for rate limiting (development)
# Optional: Configure via Dashboard with binding name INIGMA_KV
# Or add manually if needed:
# [[env.development.kv_namespaces]]
# binding = "INIGMA_KV"
# id = "YOUR_DEV_KV_ID"

# Environment variables for development
[env.development.vars]
DOMAIN = "inigma-dev.idone.su"
CLEANUP_DAYS = "50"

[env.development.triggers]
crons = ["0 2 * * *"] # Daily at 2:00 AM

[env.production]
routes = [ { pattern = "inigma.idone.su", custom_domain = true } ]

# D1 database binding
[[env.production.d1_databases]]
binding = "INIGMA_DB"
database_name = "inigma-database"
database_id = "f9c64d33-553f-4e98-a655-1e95750550af"

# KV namespace for rate limiting (production)
[[env.production.kv_namespaces]]
binding = "INIGMA_KV"
id = "32a3b5af57e14ad99d07ac3965957fee"

# Переменные окружения
[env.production.vars]
DOMAIN = "inigma.idone.su"
CLEANUP_DAYS = "50"

[env.production.triggers]
crons = ["0 2 * * *"] # Ежедневно в 2:00

# ВАЖНО: Для кастомного домена настройте его через Cloudflare Dashboard, а не через wrangler.toml.
# Инструкции см. в README.md (раздел "Настройка Custom Domain").

# Команды для деплоя:
# Development: npx wrangler deploy --env development
# Production: npx wrangler deploy --env production
